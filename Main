<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <?!= include('Styles'); ?>
</head>
<body>
  <div class="app-container">
    <!-- Top Navigation Bar -->
    <div class="top-nav">
      <div class="nav-content">
        <div class="nav-left">
          <div class="logo-container">
            <div class="logo-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="logo-text">CompTime</div>
          </div>
          
          <div class="nav-menu">
            <div class="nav-link active" onclick="navigateTo('dashboard')" data-view="dashboard">
              <i class="fas fa-home"></i>
              <span>Dashboard</span>
            </div>
            <div class="nav-link" onclick="navigateTo('employees')" data-view="employees">
              <i class="fas fa-users"></i>
              <span>Employees</span>
            </div>
            <div class="nav-link" onclick="navigateTo('coc')" data-view="coc">
              <i class="fas fa-business-time"></i>
              <span>COC</span>
            </div>
            <div class="nav-link" onclick="navigateTo('reports')" data-view="reports">
              <i class="fas fa-chart-line"></i>
              <span>Reports</span>
            </div>
            <div class="nav-link" onclick="navigateTo('masterdata')" data-view="masterdata">
              <i class="fas fa-database"></i>
              <span>Master</span>
            </div>
          </div>
        </div>

        <div class="user-info">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div style="min-width: 0;">
            <div style="font-size: 0.8125rem; color: #697386;">Logged in</div>
            <div id="currentUser" style="font-size: 0.875rem; font-weight: 600; color: #1a1f36; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Loading...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent"></div>
  </div>

  <script>
    let currentView = 'dashboard';
    let allEmployees = [];
    let selectedEmployee = null;
    let offices = [];
    let positions = [];

    // Initialize
    loadCurrentUser();
    loadDashboard();

    function loadCurrentUser() {
      google.script.run
        .withSuccessHandler(email => {
          const shortEmail = email.length > 24 ? email.substring(0, 24) + '...' : email;
          document.getElementById('currentUser').textContent = shortEmail;
          document.getElementById('currentUser').title = email;
        })
        .getCurrentUserEmail();
    }

    function navigateTo(view) {
      document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('active'));
      document.querySelector(`.nav-link[data-view="${view}"]`).classList.add('active');
      currentView = view;
      
      switch(view) {
        case 'dashboard': loadDashboard(); break;
        case 'employees': loadEmployeesView(); break;
        case 'coc': loadCOCView(); break;
        case 'reports': loadReportsView(); break;
        case 'masterdata': loadMasterDataView(); break;
      }
    }

    function loadDashboard() {
      google.script.run
        .withSuccessHandler(html => {
          document.getElementById('mainContent').innerHTML = html;
          loadDashboardStats();
        })
        .include('Dashboard');
    }

    function loadEmployeesView() {
      google.script.run
        .withSuccessHandler(html => {
          document.getElementById('mainContent').innerHTML = html;
          loadEmployees();
          loadDropdownData();
        })
        .include('Employees');
    }

    function loadCOCView() {
      google.script.run
        .withSuccessHandler(html => {
          document.getElementById('mainContent').innerHTML = html;
        })
        .include('COC');
    }

    function loadReportsView() {
      google.script.run
        .withSuccessHandler(html => {
          document.getElementById('mainContent').innerHTML = html;
        })
        .include('Reports');
    }

    function loadMasterDataView() {
      google.script.run
        .withSuccessHandler(html => {
          document.getElementById('mainContent').innerHTML = html;
          refreshMasterData();
        })
        .include('MasterData');
    }

    function showAlert(message, type = 'success') {
      const colors = {
        success: { bg: '#e6f9ed', border: '#00b528', text: '#00b528', icon: 'check-circle' },
        error: { bg: '#fee', border: '#ef4444', text: '#ef4444', icon: 'exclamation-circle' },
        info: { bg: '#e6f3ff', border: '#3b82f6', text: '#3b82f6', icon: 'info-circle' }
      };
      const color = colors[type];
      
      const alert = document.createElement('div');
      alert.style.cssText = `
        position: fixed; top: 5rem; right: 1.5rem; z-index: 200;
        background: ${color.bg}; border: 1px solid ${color.border}; color: ${color.text};
        padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-weight: 500; font-size: 0.9375rem; max-width: 400px;
        display: flex; align-items: center; gap: 0.75rem;
      `;
      alert.innerHTML = `<i class="fas fa-${color.icon}"></i><span>${message}</span>`;
      document.body.appendChild(alert);
      setTimeout(() => alert.remove(), 3000);
    }
  </script>

  <?!= include('EmployeesScript'); ?>
  <?!= include('DashboardScript'); ?>
  <?!= include('MasterDataScript'); ?>
</body>
</html>
